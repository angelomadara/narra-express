name: Mirror to GitLab
on:
  push:
    branches: ["**"]
    tags: ["**"]
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Push to GitLab
        run: |
          git remote add gitlab https://oauth2:$GITLAB_PERSONAL_TOKEN@gitlab.com/personal-kind/earthquake-ph-nodejs.git
          # git push --mirror gitlab
          echo "token ${{secrets.GITLAB_PERSONAL_TOKEN}}"
          # Push only the current branch/tag that triggered the workflow
          if [[ "${{ github.ref_type }}" == "branch" ]]; then
            echo "üîÑ Mirroring branch: ${{ github.ref_name }} to GitLab..."
            git push gitlab ${{ github.ref_name }}
            echo "‚úÖ Branch ${{ github.ref_name }} successfully mirrored to GitLab"
          elif [[ "${{ github.ref_type }}" == "tag" ]]; then
            echo "üè∑Ô∏è Mirroring tag: ${{ github.ref_name }} to GitLab..."
            git push gitlab refs/tags/${{ github.ref_name }}:refs/tags/${{ github.ref_name }}
            echo "‚úÖ Tag ${{ github.ref_name }} successfully mirrored to GitLab"
          else
            echo "‚ö†Ô∏è Unknown ref type: ${{ github.ref_type }}, skipping mirror"
            exit 1
          fi